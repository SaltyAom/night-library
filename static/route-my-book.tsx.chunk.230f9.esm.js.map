{"version":3,"sources":["webpack:///./routes/my-book.tsx"],"names":["MyBook","username","initial","useStoreon","data","books","error","useSWR","graphqlRequest","returned","updateReturned","useState","returnBook","async","success","graphqlBase","id","console","log","class","onClick","window","location","reload","Array","fill","map","_","index","key","preload","hiddenPrice","length","filter","book","includes","action","href"],"mappings":"uZA6GeA,UA9FA,KACX,IAAI,SAAEC,EAAF,QAAYC,GAAYC,YAAiC,WAAY,YAEnEC,KAAMC,EAAR,MAAeC,GAAUC,YACzB,CACI,eACC,mNAWLC,MAGCC,EAAUC,GAAkBC,YAAmB,IAEhDC,EAAaC,UACb,IAAI,QAAEC,SAAkBC,YACpB,cACC,kDACwBC,mEAM7B,IAAKF,EAAS,OAAOG,QAAQC,IAAI,wBAEjCR,EAAe,IAAID,EAAUO,KAGjC,OAAIV,EAEI,uBAASU,GAAG,YAAYG,MAAM,UAC1B,kBAAIA,MAAM,SAAV,mBACA,iBAAGA,MAAM,UAAT,mDAGA,sBAAQA,MAAM,SAASC,QAAS,IAAMC,OAAOC,SAASC,UAAtD,WAMPlB,GAASH,EAEN,uBAASc,GAAG,aACR,kBAAIG,MAAM,UAAV,WACCK,MAAM,GACFC,KAAK,MACLC,IAAI,CAACC,EAAGC,IACL,YAAC,IAAD,CAAaC,IAAKD,EAAOE,SAAO,EAACC,aAAW,MAK3D9B,EAGAI,EAAM2B,OAYP,uBAAShB,GAAG,aACR,kBAAIG,MAAM,UAAV,WACCd,EACI4B,OAAQC,IAAgBzB,EAAS0B,SAASD,EAAKlB,KAC/CU,IAAKQ,GACF,YAAC,IAAD,GACIL,IAAKK,EAAKlB,IACN,CAAEkB,QAFV,CAGIH,aAAW,EACXX,QAASR,EACTwB,OAAO,cApBnB,uBAASpB,GAAG,YAAYG,MAAM,UAC1B,kBAAIA,MAAM,SAAV,aACA,iBAAGA,MAAM,UAAT,+BACA,YAAC,IAAD,CAAMkB,KAAK,KACP,sBAAQlB,MAAM,mBAAd,sBARL,YAAC,IAAD,CAAUkB,KAAK","file":"route-my-book.tsx.chunk.230f9.esm.js","sourcesContent":["import { h } from 'preact'\nimport { useState } from 'preact/hooks'\n\nimport { Link, Redirect } from 'wouter/preact'\n\nimport useSWR from 'swr'\nimport graphqlRequest, { graphqlBase } from '../libs/graphql'\n\nimport BookDisplay from '../component/book'\nimport { Book } from '../component/book/types'\n\nimport '../styles/landing.styl'\nimport { useStoreon } from 'storeon/preact'\nimport { UserStore, UserEvent } from '../stores/types'\n\nconst MyBook = () => {\n    let { username, initial } = useStoreon<UserStore, UserEvent>('username', 'initial')\n\n    let { data: books, error } = useSWR(\n        [\n            'listBorrowed',\n            `{\n              listBorrowed {\n                data {\n                  id,\n                  title,\n                  author,\n                  price\n                }\n              }\n            }`\n        ],\n        graphqlRequest\n    )\n\n    let [returned, updateReturned] = useState<String[]>([])\n\n    let returnBook = async (id: string) => {\n        let { success } = await graphqlBase(\n            'returnBooks',\n            `mutation {\n              returnBooks(books: [\"${id}\"]) {\n                success\n              }\n            }`\n        )\n\n        if (!success) return console.log('Something went wrong')\n\n        updateReturned([...returned, id])\n    }\n\n    if (error)\n        return (\n            <section id=\"book-list\" class=\"-error\">\n                <h3 class=\"title\">Failed to fetch</h3>\n                <p class=\"detail\">\n                    There is a problem requesting an list of books.\n                </p>\n                <button class=\"action\" onClick={() => window.location.reload()}>\n                    Retry\n                </button>\n            </section>\n        )\n\n    if (!books || initial)\n        return (\n            <section id=\"book-list\">\n                <h1 class=\"header\">My Book</h1>\n                {Array(8)\n                    .fill(null)\n                    .map((_, index) => (\n                        <BookDisplay key={index} preload hiddenPrice />\n                    ))}\n            </section>\n        )\n\n    if (!username)\n        return <Redirect href=\"/signin\" />\n\n    if (!books.length)\n        return (\n            <section id=\"book-list\" class=\"-error\">\n                <h3 class=\"title\">No Borrow</h3>\n                <p class=\"detail\">No book have been borrowed.</p>\n                <Link href=\"/\">\n                    <button class=\"action -compact\">Borrow some book</button>\n                </Link>\n            </section>\n        )\n\n    return (\n        <section id=\"book-list\">\n            <h1 class=\"header\">My Book</h1>\n            {books\n                .filter((book: Book) => !returned.includes(book.id))\n                .map((book: Book) => (\n                    <BookDisplay\n                        key={book.id}\n                        {...{ book }}\n                        hiddenPrice\n                        onClick={returnBook}\n                        action=\"Return\"\n                    />\n                ))}\n        </section>\n    )\n}\n\nexport default MyBook\n"],"sourceRoot":""}